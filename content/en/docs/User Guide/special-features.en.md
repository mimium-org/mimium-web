---
title: mimium固有の機能
date: 2021-01-17T03:32:12.504Z
weight: 2
description: このセクションでは、mimiumの特徴的な言語機能について説明します。
draft: false
toc_hide: false
---

# mimium固有の言語機能

## `self`による信号フィードバックの表現

関数の中では、`self`という特別なキーワードが使用できます。
`self`は関数が最後に返した値を参照できる変数です。たとえば、以下のような関数を作ると呼び出される度`increment`ずつ増える値を返します。

```rust
fn counter(increment){
  self+increment
}
```

`self`はオーディオエンジンが開始された時に0で初期化され、呼び出しコンテキストごとに別々の値が生成、管理されます。
たとえば以下の例では`counter`関数にそれぞれ異なる`increment`を与えていますが、この場合内部的に`self`のためのメモリは2つ分確保され、`lch`は毎サンプル0.01ずつ増えて1を越えるたび0にリセットされ、`rch`は毎サンプル0.05ずつ増えます。

```rust
fn dsp()->(float,float){
  let lch = counter(0.01)%1
  let rch = counter(0.05)%1
  (lch,rch)
}
```

> [!NOTE]
> selfは現在常に0か、タプルであれば全てのメンバが0になるような形で初期化されます。この初期値を変更する方法は現在検討中です。またself自体が関数型や関数型をメンバに含むタプル型になる場合はコンパイルエラーになります。



## `@`演算子による遅延実行

関数呼び出しに続けて`@`と数値型の値を続けることで、関数の実行を遅らせることができます。
時間の単位はサンプルです。

たとえば以下の例ではオーディオドライバをスタートしてから0サンプル目と48000サンプル目に、100と200を続けて標準出力に書き込みます。

```rust
println(100)@0
println(200)@48000
```

現在`@`演算子は`void`型の（返り値を持たない）関数にのみ使用することが可能です。

再帰関数の実行を`@`で遅延させることにより、一定間隔で特定の処理を繰り返すことも可能です。
たとえば以下の例では48000サンプル間隔で0から1ずつ数値を増やして標準出力に書き込みます。
```rust
fn loopprint(input)->void{
  println(input)
  loopprint(input+1)@(now+48000)
}
loopprint(0)@0
```
